{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main js functions for block_timezoneclock\n *\n * @module block_timezoneclock/main\n * @copyright 2022 Harshil Patel <harshil8595@gmail.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport DynamicForm from 'core_form/dynamicform';\nimport {replaceNodeContents} from 'core/templates';\n\nconst dtOptions = {\n    year: 'numeric',\n    month: 'short',\n    weekday: 'short',\n    day: 'numeric',\n    hour: 'numeric',\n    minute: 'numeric',\n    second: 'numeric',\n    hour12: true\n};\nconst getDateInfo = (timeZone, timestamp = new Date()) => {\n    const locale = 'en-us';\n    const ctdt = new Date(timestamp.toLocaleString(locale, {timeZone}));\n    const [day, month, date, year, dateinfo, meridiem] = ctdt\n        .toLocaleString(locale, dtOptions).replace(/,/gi, '').split(' ');\n    const [hour, minute, second] = dateinfo.split(':').map(unit => unit.padStart(2, 0));\n    return {day, month, date: date.padStart(2, 0), year, hour, minute, second, meridiem};\n};\n\nconst updateTime = () => document.querySelectorAll('[data-region=\"clock\"]:not([data-autoupdate=\"false\"])')\n    .forEach(clock => {\n        const datefractions = getDateInfo(clock.dataset.timezone);\n        clock.querySelectorAll('[data-fraction]').forEach(sp => {\n            const {fraction, unit} = sp.dataset;\n            if (unit?.toString() !== datefractions[fraction].toString()) {\n                sp.style.setProperty(`--unit`, datefractions[fraction]);\n                sp.setAttribute('data-unit', datefractions[fraction]);\n                sp.firstElementChild.innerText = datefractions[fraction].toString();\n            }\n        });\n});\n\nexport const initBlock = () => {\n    setInterval(updateTime, 1000);\n};\n\nexport const registerForm = formUniqId => {\n    const form = document.getElementById(formUniqId);\n    if (form) {\n        const dForm = new DynamicForm(form, form.dataset.formClass);\n        dForm.load({\n            instanceid: form.closest('[data-instance-id]').getAttribute('data-instance-id')\n        });\n        dForm.addEventListener(dForm.events.FORM_SUBMITTED, e => {\n            e.preventDefault();\n            replaceNodeContents(form.nextElementSibling, e.detail.html, e.detail.js);\n        });\n    }\n};\n"],"names":["dtOptions","year","month","weekday","day","hour","minute","second","hour12","updateTime","document","querySelectorAll","forEach","clock","datefractions","timeZone","timestamp","Date","locale","ctdt","toLocaleString","date","dateinfo","meridiem","replace","split","map","unit","padStart","getDateInfo","dataset","timezone","sp","fraction","toString","style","setProperty","setAttribute","firstElementChild","innerText","setInterval","formUniqId","form","getElementById","dForm","DynamicForm","formClass","load","instanceid","closest","getAttribute","addEventListener","events","FORM_SUBMITTED","e","preventDefault","nextElementSibling","detail","html","js"],"mappings":";;;;;;;qLAyBMA,UAAY,CACdC,KAAM,UACNC,MAAO,QACPC,QAAS,QACTC,IAAK,UACLC,KAAM,UACNC,OAAQ,UACRC,OAAQ,UACRC,QAAQ,GAWNC,WAAa,IAAMC,SAASC,iBAAiB,wDAC9CC,SAAQC,cACCC,cAXM,SAACC,cAAUC,iEAAY,IAAIC,WACrCC,OAAS,QACTC,KAAO,IAAIF,KAAKD,UAAUI,eAAeF,OAAQ,CAACH,SAAAA,aACjDX,IAAKF,MAAOmB,KAAMpB,KAAMqB,SAAUC,UAAYJ,KAChDC,eAAeF,OAAQlB,WAAWwB,QAAQ,MAAO,IAAIC,MAAM,MACzDpB,KAAMC,OAAQC,QAAUe,SAASG,MAAM,KAAKC,KAAIC,MAAQA,KAAKC,SAAS,EAAG,WACzE,CAACxB,IAAAA,IAAKF,MAAAA,MAAOmB,KAAMA,KAAKO,SAAS,EAAG,GAAI3B,KAAAA,KAAMI,KAAAA,KAAMC,OAAAA,OAAQC,OAAAA,OAAQgB,SAAAA,UAKjDM,CAAYhB,MAAMiB,QAAQC,UAChDlB,MAAMF,iBAAiB,mBAAmBC,SAAQoB,WACxCC,SAACA,SAADN,KAAWA,MAAQK,GAAGF,SACxBH,MAAAA,YAAAA,KAAMO,cAAepB,cAAcmB,UAAUC,aAC7CF,GAAGG,MAAMC,qBAAsBtB,cAAcmB,WAC7CD,GAAGK,aAAa,YAAavB,cAAcmB,WAC3CD,GAAGM,kBAAkBC,UAAYzB,cAAcmB,UAAUC,qCAKhD,KACrBM,YAAY/B,WAAY,4BAGAgC,mBAClBC,KAAOhC,SAASiC,eAAeF,eACjCC,KAAM,OACAE,MAAQ,IAAIC,qBAAYH,KAAMA,KAAKZ,QAAQgB,WACjDF,MAAMG,KAAK,CACPC,WAAYN,KAAKO,QAAQ,sBAAsBC,aAAa,sBAEhEN,MAAMO,iBAAiBP,MAAMQ,OAAOC,gBAAgBC,IAChDA,EAAEC,oDACkBb,KAAKc,mBAAoBF,EAAEG,OAAOC,KAAMJ,EAAEG,OAAOE"}